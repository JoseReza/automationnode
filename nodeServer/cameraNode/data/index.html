<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Camera</title>
    <link rel="icon" href="./icon.png">
    <style>
        button:hover {
            background-color: #fff;
            color: #000;
        }

        #logo {
            position: relative;
            animation-name: animationLogo;
            animation-duration: 10s;
            animation-iteration-count: infinite;
        }

        @keyframes animationLogo {
            0% {
                transform: rotate(0deg);
            }
            33% {
                transform: rotate(120deg);
            }
            66% {
                transform: rotate(240deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
  </head>
  <body style=" background-color: #ddd;">
    <div style="align-items: center; text-align: center;">

        <table style="width: 100%; height: 20%;">
            <tr>
                <td style="width: 25%; margin-left: 5%; background-color: #2196f3; border-radius: 10px; color: white; border: #fff solid; vertical-align: middle;">
                    <img id="logo" src="./icon.png" width="50" height="50">
                    <div>Automation Node</div>
                </td>
                <td style="width: 30%; margin-left: 5%; background-color: #2196f3; border-radius: 10px; color: white; border: #fff solid; vertical-align: middle;">
                    <h3>Camera</h3>
                </td>
                <td style="width: 25%; height: 100%; margin-left: 5%;">
                    <button id="buttonSave" onmouseover="this.style.backgroundColor = '#000'; this.style.color = '#fff';" onmouseleave="this.style.backgroundColor = '#fff'; this.style.color = '#2196f3';" onclick="this.style.backgroundColor = '#2196f3';" style="background-color: #fff; color: #2196f3; width: 100%; height: 100%; border-radius: 10px; border: #fff;"><h2>Save configuration</h2></button>
                </td>
            </tr>
        </table>
        <br>
        <br>
        
        <div style="width: 70%; margin-left: 15%; border-radius: 10px; border: #fff solid; background-color: #2196f3; color: #fff;">
            <div style="background: #fff; color: #2196f3;" >End points</div>
            <br>
            <br>
            <a href="capture.html" onmouseover="this.style.backgroundColor = '#000'; this.style.color = '#fff';" onmouseleave="this.style.backgroundColor = '#fff'; this.style.color = '#2196f3';" style="background-color: #fff; color: #2196f3; text-decoration: none; border-radius: 10px; border: #fff solid;">Capture</a>
            <br>
            <br>
            <a href="stream.html" onmouseover="this.style.backgroundColor = '#000'; this.style.color = '#fff';" onmouseleave="this.style.backgroundColor = '#fff'; this.style.color = '#2196f3';" style="background-color: #fff; color: #2196f3; text-decoration: none; border-radius: 10px; border: #fff solid;">Stream</a>
            <br>
            <br>
            <!--
            <a href="status" onmouseover="this.style.backgroundColor = '#000'; this.style.color = '#fff';" onmouseleave="this.style.backgroundColor = '#fff'; this.style.color = '#2196f3';" style="background-color: #fff; color:#2196f3; text-decoration: none; border-radius: 10px; border: #fff solid;">Status</a>
            <br>
            <br>
            -->
        </div>
        <br>
      
        <div style="width: 70%; margin-left: 15%; border-radius: 10px; border: #fff solid; background-color: #2196f3; color: #fff;">
            <div style="background: #fff; color: #2196f3;" >Wifi mode</div>
            <br>
            <input type="radio" name="wifiMode" id="wifiClient"><label>Client</label>
            <br>
            <input type="radio" name="wifiMode" id="wifiAccessPoint" checked><label>Access point</label>
            <br>
            <br>
        </div>
        <br>
        <br>

        <div style="width: 70%; margin-left: 15%; border-radius: 10px; border: #fff solid; background-color: #2196f3; color: #fff;">
            <div style="background: #fff; color: #2196f3;" >Wifi client</div>
            <br>
            <label>Name: </label>
            <br>
            <input type="text" id="wifiClientName" />
            <br>
            <br>
            <label>Password: </label>
            <br>
            <input type="text" id="wifiClientPassword" />
            <br>
            <br>
            <label> Ip mode:</label>
            <br>
            <br>
            <input type="radio" value="static" name="ipMode" id="ipModeStatic"><label> static</label>
            <br>
            <br>
            <label> Ip: </label>
            <input type="number" min="1" max="255" id="ipClient0" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClient1" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClient2" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClient3" style="width: 10%;">
            <br>
            <br>
            <label> Ip gateway: </label>
            <input type="number" min="1" max="255" id="ipClientGateway0" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientGateway1" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientGateway2" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientGateway3" style="width: 10%;">
            <br>
            <br>
            <label> Ip subnet: </label>
            <input type="number" min="1" max="255" id="ipClientSubnet0" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientSubnet1" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientSubnet2" style="width: 10%;">.
            <input type="number" min="1" max="255" id="ipClientSubnet3" style="width: 10%;">
            <br>
            <br>
            <input type="radio" value="dynamic" name="ipMode" id="ipModeDynamic"><label>dynamic</label>
            <br>
            <br>
            <br>
        </div>
        <br>
        <br>

        <div style="width: 70%; margin-left: 15%; border-radius: 10px; border: #fff solid; background-color: #2196f3; color: #fff;">
            <div style="background: #fff; color: #2196f3;" >Wifi access point</div>
            <br>
            <label>Name: </label>
            <br>
            <input type="text" id="wifiAccessPointName" readonly />
            <br>
            <br>
            <label>Password: </label>
            <br>
            <input type="text" id="wifiAccessPointPassword" />
            <br>
            <br>
            <input type="number" min="1" max="255" id="ipClient0" style="width: 10%;" value="192" readonly>.
            <input type="number" min="1" max="255" id="ipClient1" style="width: 10%;" value="168" readonly>.
            <input type="number" min="1" max="255" id="ipClient2" style="width: 10%;" value="4" readonly>.
            <input type="number" min="1" max="255" id="ipClient3" style="width: 10%;" value="1" readonly>
            <br>
            <br>
        </div>
        <br>
        <br>
    </div>
    <script>

        let buttonSave = document.getElementById("buttonSave");

        let wifiClient = document.getElementById("wifiClient");
        let wifiClientName = document.getElementById("wifiClientName");
        let wifiClientPassword = document.getElementById("wifiClientPassword");
        let ipModeStatic = document.getElementById("ipModeStatic");
        let ipClient0 = document.getElementById("ipClient0");
        let ipClient1 = document.getElementById("ipClient1");
        let ipClient2 = document.getElementById("ipClient2");
        let ipClient3 = document.getElementById("ipClient3");
        let ipClientGateway0 = document.getElementById("ipClientGateway0");
        let ipClientGateway1 = document.getElementById("ipClientGateway1");
        let ipClientGateway2 = document.getElementById("ipClientGateway2");
        let ipClientGateway3 = document.getElementById("ipClientGateway3");
        let ipClientSubnet0 = document.getElementById("ipClientSubnet0");
        let ipClientSubnet1 = document.getElementById("ipClientSubnet1");
        let ipClientSubnet2 = document.getElementById("ipClientSubnet2");
        let ipClientSubnet3 = document.getElementById("ipClientSubnet3");
        let ipModeDynamic = document.getElementById("ipModeDynamic");

        let wifiAccessPoint = document.getElementById("wifiAccessPoint");
        let wifiAccessPointName = document.getElementById("wifiAccessPointName");
        let wifiAccessPointPassword = document.getElementById("wifiAccessPointPassword");

        async function start(){

            let response = await fetch(location.origin + "/configuration.json");
            let configuration = await response.json();

            console.log(configuration);

            wifiClient.checked = configuration.wifi.client.activated;
            wifiClientName.value = configuration.wifi.client.name;
            wifiClientPassword.value = configuration.wifi.client.password;
            ipModeStatic.checked = configuration.wifi.client.ipMode.static;
            ipClient0.value = configuration.wifi.client.ip.static["0"];
            ipClient1.value = configuration.wifi.client.ip.static["1"];
            ipClient2.value = configuration.wifi.client.ip.static["2"];
            ipClient3.value = configuration.wifi.client.ip.static["3"];
            ipClientGateway0.value = configuration.wifi.client.ip.gateway["0"];
            ipClientGateway1.value = configuration.wifi.client.ip.gateway["1"];
            ipClientGateway2.value = configuration.wifi.client.ip.gateway["2"];
            ipClientGateway3.value = configuration.wifi.client.ip.gateway["3"];
            ipClientSubnet0.value = configuration.wifi.client.ip.subnet["0"];
            ipClientSubnet1.value = configuration.wifi.client.ip.subnet["1"];
            ipClientSubnet2.value = configuration.wifi.client.ip.subnet["2"];
            ipClientSubnet3.value = configuration.wifi.client.ip.subnet["3"];
            ipModeDynamic.checked = configuration.wifi.client.ipMode.dynamic;

            wifiAccessPoint.ckecked = configuration.wifi.accessPoint.activated;
            wifiAccessPointName.value = configuration.wifi.accessPoint.name + configuration.system.id;
            wifiAccessPointPassword.value = configuration.wifi.accessPoint.password;

            buttonSave.addEventListener("click", async ()=>{

                configuration.wifi.client.activated = wifiClient.checked;
                configuration.wifi.client.name = wifiClientName.value;
                configuration.wifi.client.password = wifiClientPassword.value;
                configuration.wifi.client.ipMode.static = ipModeStatic.checked;
                configuration.wifi.client.ip.static["0"] = ipClient0.value;
                configuration.wifi.client.ip.static["1"] = ipClient1.value;
                configuration.wifi.client.ip.static["2"] = ipClient2.value;
                configuration.wifi.client.ip.static["3"] = ipClient3.value;
                configuration.wifi.client.ip.gateway["0"] = ipClientGateway0.value;
                configuration.wifi.client.ip.gateway["1"] = ipClientGateway1.value;
                configuration.wifi.client.ip.gateway["2"] = ipClientGateway2.value;
                configuration.wifi.client.ip.gateway["3"] = ipClientGateway3.value;
                configuration.wifi.client.ip.subnet["0"] = ipClientSubnet0.value;
                configuration.wifi.client.ip.subnet["1"] = ipClientSubnet1.value;
                configuration.wifi.client.ip.subnet["2"] = ipClientSubnet2.value;
                configuration.wifi.client.ip.subnet["3"] = ipClientSubnet3.value;
                configuration.wifi.client.ipMode.dynamic = ipModeDynamic.checked;

                configuration.wifi.accessPoint.activated = wifiAccessPoint.ckecked;
                configuration.wifi.accessPoint.password = wifiAccessPointPassword.value;


                if(!configuration.wifi.client.activated){
                    configuration.wifi.accessPoint.activated = true;
                }else{
                    configuration.wifi.accessPoint.activated = false;
                }

                console.log("radiobutton client", configuration.wifi.client.activated);
                console.log("radiobutton accespoint", configuration.wifi.accessPoint.activated);


                let response = await fetch(location.origin + "/data", {
                    method: "POST",
                    body: JSON.stringify({
                        saveConfiguration: true,
                        configuration: configuration
                    })
                });

                let responseJson = await response.json();

                if(responseJson.return == true){
                    buttonSave.style.backgroundColor = "#4caf50";
                    setTimeout(function(){
                        buttonSave.style.backgroundColor = "#000";
                        buttonSave.style.color = "#fff";
                        alert("Configuration saved succesfully, your device is restarting for apply changes")
                    }, 1000)
                    console.log("Saved", responseJson);
                }
            });

        }start()
    </script>
  </body>
</html>
