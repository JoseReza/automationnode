<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logic analizer</title>
  </head>
  <body>
  </body>
</html>
<script src="./chart.js"></script>
<script>

  let pinArray = ["A0", "A1", "A2", "A3", "A4", "A5", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"];
  let chartArray = [];
  let chartInstanceArray = [];
  let arraysAxisX = [];
  let arraysAxisY = [];

  for(let pin of pinArray){
    let chart = document.createElement("canvas");
    chart.setAttribute("width", "400");
    chart.setAttribute("height", "100");
    document.body.appendChild(chart);
    chartArray.push(chart);
    let arrayAxisX = [];
    let arrayAxisY = [];
    arraysAxisX.push(arrayAxisX);
    arraysAxisY.push(arrayAxisY);

    let chartInstance = new Chart(chart, {
    type: "line",
    data: {
      labels: arrayAxisX,
      datasets: [
        {
          label: pin,
          data: arrayAxisY,
          backgroundColor: "rgba(54, 162, 235, 0.2)",
          borderColor: "rgba(54, 162, 235, 1)",
          borderWidth: 1,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          max: 5,
          suggestedMax: 500,
        },
      },
    },
  });

  chartInstance.options.animation = false; // disables all animations

  chartInstanceArray.push(chartInstance);

  }

  setInterval(async function () {
    let data = await fetch("/data");
    data = await data.json();
    console.log(data);

    const currentDate = new Date();
    let xAxisLabel = `${currentDate.getMinutes()}:${currentDate.getSeconds()}`;
    
    

    for(let index in pinArray){
      console.log(index);
      console.log(arraysAxisX);
      arraysAxisX[index].push(xAxisLabel);
      if(pinArray[index][0] == "A" || pinArray[index][0] == "a"){
        arraysAxisY[index].push((data[pinArray[index]] / 1024) * 5);  //Analogo
      }else{
        arraysAxisY[index].push(data[pinArray[index]] * 5); //Digital
      }
      chartInstanceArray[index].update();
    }
    
  }, 100);
</script>
